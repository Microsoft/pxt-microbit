# Rotary Dial Radio

Rotary dial phones may not be of the latest tech fashion but they've still got some wings if you pair them with a @boardname@. If you are lucky enough to still own one of those antiques, you follow this guide to upgrade it to the 21st century.

![A rotary dial phone connected to a @boardname@](/static/mb/projects/rotary-dial-radio/final.jpg)

This guide is a journal of notes and techniques used to convert a 1945 rotary dial into a @boardname@ radio encoder. This is an example of **reverse engineering**, a treasure hunt for engineers if you wish.

### ~ hint

### Stay safe

Opening and handling electrical device can be very dangerous. Make sure to unplug all sources of power. Unless you know what you are doing stay away from wall power (AC).

### ~

## What is Pulse dialing?


The phone below is a Belgium rotary dial phone from 1945. It's heavy and the dial does a wonderful clicking noise when it turns.

![Antique rotary dial phone](/static/mb/projects/rotary-dial-radio/oldphone.jpg)

If you skim through the WikiPedia on "rotary dial phones", you'll quickly learn that they used something called **pulse dialing** (https://en.wikipedia.org/wiki/Pulse_dialing). In a nutshell, the dial sends opens and closes the circuit while it rotates which sends a serie of electrical pulses on the phone line. 1 pulse for number 1, 2 for number 2, and so. 0 would be 10 pulses.

## Digging into the phone

Fortunately for us, the bottom of the phone can easily be removed by pressing lever. It reveals the internals of the phone. One can see the two massive bells to ring the phone and some other transistors and circuitery. 

![Inside of a rotary phone](/static/mb/projects/rotary-dial-radio/guts.jpg)

Most interrestingly, there are 8 terminals near the 2 holes in the case for wires. 
* 2 terminals on each side are connected via a black wire. This is most likely the ground wire.
* the phone line was missing but there is still a hole for it. Since phone lines carry a bit of electrical current, we'll inject electricity via those terminals.
* 3 terminals seem to be used by the handset so they must be carrying some kind of microphone/speaker signal. We'll try each of them.

At this point, we have enough information to start "scoping" the lines and hopefully get lucky and see the pulses. (Did I mention treasure hunting?)

## Scoping the lines

Electrical engineers use tools called "scopes" to "see" the eletrical signals on the line. In our case, we'd like to see the pulses generated by the dial. We don't have a scope so we'll use the @boardname@ instead.

We connect the @boardname@ to the phone using 3 croc clips:
* **GND** pin to the ground terminal
* **3v** pin to the positive terminal on the phone line
* **P0** to one of the headset line (not **GND**)

![Wiring](/static/mb/projects/rotary-dial-radio/wired.jpg)

In the MakeCode, we upload a program that reads the analog input on **P0** and plots it on the screen. If you pair your @boardname@, you can also see the data in the console view.

```blocks
basic.forever(function () {
    led.plotBarGraph(
    pins.analogReadPin(AnalogPin.P0),
    1023
    )
})
```

Try moving the dial slowing, click and click and you should see the pulses, e.g. the signal going high and low. If you don't see anything, keep trying other cables. Be patient, don't give up.

![Scoping the phone](/static/mb/projects/rotary-dial-radio/tone.mp4)

## Decoding the pulses


## Final program


![Dialing the micro:bit phone](/static/mb/projects/rotary-dial-radio/dial.mp4)

```blocks
pins.onPulsed(DigitalPin.P0, PulseValue.High, function () {
    led.plot(0, 0)
})
function plotIndex (i: number, on: boolean) {
    row = Math.idiv(i, 5)
    col = i % 5
    if (on) {
        led.plot(col, row)
    } else {
        led.unplot(col, row)
    }
}
function codeDots () {
    for (let index = 0; index <= 4; index++) {
        led.plot(index, 2)
    }
    for (let index2 = 0; index2 <= 9; index2++) {
        plotIndex(15 + index2, index2 < code.length)
    }
}
pins.onPulsed(DigitalPin.P0, PulseValue.Low, function () {
    led.unplot(0, 0)
    if (lastPulseMs == 0) {
        pulseCount = 0
        lastPulseMs = input.runningTime()
    } else if (input.runningTime() - lastPulseMs > 85) {
        pulseCount += 1
        lastPulseMs = input.runningTime()
    }
})
let codeNumber = 0
let lastDigitMs = 0
let col = 0
let row = 0
let pulseCount = 0
let code = ""
let lastPulseMs = 0
radio.setGroup(1)
lastPulseMs = 0
code = ""
pulseCount = 0
basic.forever(function () {
    if (lastPulseMs > 0 && input.runningTime() - lastPulseMs >= 250) {
        led.plot(1, 0)
        if (pulseCount == 10) {
            pulseCount = 0
        }
        code = "" + code + convertToText(pulseCount)
        lastPulseMs = 0
        lastDigitMs = input.runningTime()
    } else if (lastPulseMs == 0 && (code.length > 0 && (code.length == 10 || input.runningTime() - lastDigitMs >= 3000))) {
        led.plot(2, 0)
        codeNumber = parseFloat(code)
        for (let index = 0; index < 1; index++) {
            radio.sendNumber(codeNumber)
            basic.pause(10)
        }
        basic.clearScreen()
        basic.showNumber(codeNumber)
        basic.clearScreen()
        code = ""
        lastPulseMs = 0
    } else {
        led.unplot(1, 0)
        led.unplot(2, 0)
    }
    codeDots()
})
```